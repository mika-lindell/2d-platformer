var Level,__slice=[].slice;Level=function(){function t(t,e){this.game=e,this.load(t)}return t.prototype.w=0,t.prototype.h=0,t.prototype.treasures=0,t.prototype.ninjas=[],t.prototype.load=function(t){var e,r,i,n,s;return this.ninjas=[],this.treasures=0,e=function(){var e,r,n,s;for(n=t.data.split("\n"),s=[],e=0,r=n.length;r>e;e++)i=n[e],s.push(i.split(""));return s}(),this.map=function(){var t,o,a;for(a=[],s=t=0,o=e.length;o>t;s=++t)i=e[s],a.push(function(){var t,e,o;for(o=[],n=t=0,e=i.length;e>t;n=++t)switch(r=i[n]){case"@":o.push(new Dirt);break;case"O":o.push(new Rock);break;case"P":this.addPlayer(n,s),o.push(new Block);break;case"X":this.addNinja(n,s),o.push(new Block);break;case"*":this.treasures++,o.push(new Treasure);break;case"#":o.push(new Ladder);break;case"-":o.push(new Ladder(!0));break;default:o.push(new Block)}return o}.call(this));return a}.call(this),this.h=this.map.length,this.w=this.map[0].length},t.prototype.addNinja=function(t,e){var r,i,n;return i=t*gfx.tileW,n=e*gfx.tileH,r=new Ninja(this,i,n,this.game.player),this.ninjas.push(r)},t.prototype.addPlayer=function(t,e){return this.game.setPlayer(t*gfx.tileW,e*gfx.tileH,this)},t.prototype.removeBlock=function(t,e,r){return this.map[e][t]=new Block,r.constructor===Treasure&&0===--this.treasures?(alert("Level Complete!"),game.reset()):void 0},t.prototype.getBlockIndex=function(t,e){return[Math.floor(t/gfx.tileW),Math.floor(e/gfx.tileH)]},t.prototype.getBlockEdge=function(t,e){var r;return null==e&&(e=!1),r=e?gfx.tileH:gfx.tileW,utils.snap(t,r)},t.prototype.getBlock=function(t,e){var r,i,n,s;return n=this.getBlockIndex(t,e),r=n[0],i=n[1],(null!=(s=this.map[i])?s[r]:void 0)||new Rock},t.prototype.getBlocks=function(){var t,e,r,i,n,s,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],o=[],i=0,n=t.length;n>i;i++)s=t[i],e=s[0],r=s[1],o.push(this.getBlock(e,r));return o},t.prototype.update=function(){var t,e,r,i,n,s,o,a,h,l,u,p,c,d,f,y,g;for(d=this.map,n=s=0,l=d.length;l>s;n=++s)for(r=d[n],i=o=0,u=r.length;u>o;i=++o)t=r[i],t.update(i,n,this);for(f=this.ninjas,a=0,p=f.length;p>a;a++)e=f[a],e.update();for(y=this.ninjas,g=[],h=0,c=y.length;c>h;h++)e=y[h],g.push(this.checkCollision(this.game.player,e));return g},t.prototype.checkCollision=function(t,e){return t.x+t.w>=e.x&&t.x<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+e.h?(sound.play("dead"),alert("You are dead."),game.reset()):void 0},t.prototype.render=function(t){var e,r,i,n,s,o,a,h,l,u,p,c,d,f;for(c=this.map,s=o=0,l=c.length;l>o;s=++o)for(i=c[s],n=a=0,u=i.length;u>a;n=++a)e=i[n],e.render(t,n*t.tileW,s*t.tileH);for(d=this.ninjas,f=[],h=0,p=d.length;p>h;h++)r=d[h],f.push(r.render(t));return f},t.prototype.digAt=function(t,e,r){var i,n,s,o;return o=this.getBlockIndex(e,r),n=o[0],s=o[1],n+="RIGHT"===t?1:-1,s+1>this.h||0>n||n>this.w-1?void 0:(i=this.map[s+1][n],null!=i.digIt&&i.digIt(),i.constructor===Block?this.map[s+1][n]=new Gravel:void 0)},t}();