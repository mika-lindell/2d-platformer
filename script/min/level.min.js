var Level,__slice=[].slice;Level=function(){function t(t,e){this.game=e,this.load(t)}return t.prototype.w=0,t.prototype.h=0,t.prototype.treasures=0,t.prototype.ninjas=[],t.prototype.load=function(t){var e,r,n,i,o;return this.ninjas=[],this.treasures=0,e=function(){var e,r,i,o;for(i=t.data.split("\n"),o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n.split(""));return o}(),this.map=function(){var t,s,h;for(h=[],o=t=0,s=e.length;s>t;o=++t)n=e[o],h.push(function(){var t,e,s;for(s=[],i=t=0,e=n.length;e>t;i=++t)switch(r=n[i]){case"@":s.push(new Dirt);break;case"O":s.push(new Rock);break;case"P":this.addPlayer(i,o),s.push(new Block);break;case"X":this.addNinja(i,o),s.push(new Block);break;case"*":this.treasures++,s.push(new Treasure);break;case"#":s.push(new Ladder);break;case"-":s.push(new Ladder(!0));break;default:s.push(new Block)}return s}.call(this));return h}.call(this),this.h=this.map.length,this.w=this.map[0].length},t.prototype.addNinja=function(t,e){var r,n,i;return n=t*gfx.tileW,i=e*gfx.tileH,r=new Ninja(this,n,i,this.game.player),this.ninjas.push(r)},t.prototype.addPlayer=function(t,e){return this.game.setPlayer(t*gfx.tileW,e*gfx.tileH,this)},t.prototype.removeBlock=function(t,e,r){return this.map[e][t]=new Block,r.constructor===Treasure&&0===--this.treasures?(alert("Level Complete!"),game.reset()):void 0},t.prototype.getBlockIndex=function(t,e){return[Math.floor(t/gfx.tileW),Math.floor(e/gfx.tileH)]},t.prototype.getBlockEdge=function(t,e){var r;return null==e&&(e=!1),r=e?gfx.tileH:gfx.tileW,utils.snap(t,r)},t.prototype.getBlock=function(t,e){var r,n,i,o;return i=this.getBlockIndex(t,e),r=i[0],n=i[1],(null!=(o=this.map[n])?o[r]:void 0)||new Rock},t.prototype.getBlocks=function(){var t,e,r,n,i,o,s;for(t=1<=arguments.length?__slice.call(arguments,0):[],s=[],n=0,i=t.length;i>n;n++)o=t[n],e=o[0],r=o[1],s.push(this.getBlock(e,r));return s},t.prototype.update=function(){var t,e,r,n,i,o,s,h,p,u,l,a,c,f,d,y,g;for(f=this.map,i=o=0,u=f.length;u>o;i=++o)for(r=f[i],n=s=0,l=r.length;l>s;n=++s)t=r[n],t.update(n,i,this);for(d=this.ninjas,h=0,a=d.length;a>h;h++)e=d[h],e.update();for(y=this.ninjas,g=[],p=0,c=y.length;c>p;p++)e=y[p],g.push(this.checkCollision(this.game.player,e));return g},t.prototype.checkCollision=function(t,e){return t.x+t.w>=e.x&&t.x<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+e.h?(alert("You are dead."),game.reset()):void 0},t.prototype.render=function(t){var e,r,n,i,o,s,h,p,u,l,a,c,f,d;for(c=this.map,o=s=0,u=c.length;u>s;o=++s)for(n=c[o],i=h=0,l=n.length;l>h;i=++h)e=n[i],e.render(t,i*t.tileW,o*t.tileH);for(f=this.ninjas,d=[],p=0,a=f.length;a>p;p++)r=f[p],d.push(r.render(t));return d},t.prototype.digAt=function(t,e,r){var n,i,o,s;return s=this.getBlockIndex(e,r),i=s[0],o=s[1],i+="RIGHT"===t?1:-1,o+1>this.h||0>i||i>this.w-1?void 0:(n=this.map[o+1][i],null!=n.digIt&&n.digIt(),n.constructor===Block?this.map[o+1][i]=new Gravel:void 0)},t}();