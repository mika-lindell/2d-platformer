var Entity;Entity=function(){function t(t,e,r){this.level=t,this.x=e,this.y=r,this.falling=!0,this.wasFalling=!0,this.onLadder=!1,this.wasOnLadder=!1,this.onTopOfLadder=!1}return t.prototype.x=0,t.prototype.y=0,t.prototype.w=18,t.prototype.h=24,t.prototype.speed=4,t.prototype.dir="LEFT",t.prototype.update=function(){},t.prototype.render=function(t){return t.ctx.fillText("?",this.x,this.y)},t.prototype.move=function(t,e){var r,n,i,o,s,h,p,u,l,a;return this.falling&&(e+=2*this.speed),this.wasFalling=this.falling,s=t,p=e,h=this.x+s,u=this.y+p,l=this.level.getBlocks([this.x,u],[this.x,u+(this.h-1)],[this.x+(this.w-1),u],[this.x+(this.w-1),u+(this.h-1)]),i=l[0],r=l[1],o=l[2],n=l[3],0>e&&(i.solid||o.solid)&&(p=this.level.getBlockEdge(this.y,"VERT")-this.y),e>0&&(r.solid||n.solid)&&(p=this.level.getBlockEdge(u+(this.h-1),"VERT")-this.y-this.h,this.falling=!1),a=this.level.getBlocks([h,this.y],[h,this.y+(this.h-1)],[h+(this.w-1),this.y],[h+(this.w-1),this.y+(this.h-1)]),i=a[0],r=a[1],o=a[2],n=a[3],0>t&&(i.solid||r.solid)&&(s=this.level.getBlockEdge(this.x)-this.x),t>0&&(o.solid||n.solid)&&(s=this.level.getBlockEdge(h+(this.w-1))-this.x-this.w),this.x+=s,this.y+=p,this.checkNewPos(t,e)},t.prototype.checkNewPos=function(t,e){var r,n,i,o,s,h,p,u,l,a,c;for(this.wasOnLadder=this.onLadder,c=this.level.getBlocks([this.x,this.y],[this.x,this.y+this.h],[this.x+(this.w-1),this.y],[this.x+(this.w-1),this.y+this.h]),h=c[0],r=c[1],u=c[2],i=c[3],o=c,l=0,a=o.length;a>l;l++)n=o[l],n.touchable&&n.touch(this);return this.onLadder=!1,p=o.some(function(t){return t.climbable}),p&&(this.onLadder=!0,this.falling=!1,0!==e&&(s=utils.snap(this.x,gfx.tileW),r.climbable||h.climbable||(this.x=s+gfx.tileW),i.climbable||u.climbable||(this.x=s))),this.onTopOfLadder=this.onLadder&&!(h.climbable||u.climbable)&&0===(this.y+this.h)%gfx.tileH,this.onLadder||this.falling||r.solid||i.solid||r.climbable||i.climbable?void 0:this.falling=!0},t}();