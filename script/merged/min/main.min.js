var gfx;gfx={tileW:24,tileH:24,init:function(){var t;return t=document.querySelector("#game"),this.ctx=null!=t?"function"==typeof t.getContext?t.getContext("2d"):void 0:void 0,this.ctx?(this.w=t.width,this.h=t.height,!0):!1},clear:function(){return this.ctx.clearRect(0,0,gfx.w,gfx.h)},load:function(t){return this.sprites=new Image,this.sprites.src="resources/sprites.png",this.sprites.onload=function(){return t()}},drawSprite:function(t,e,r,n,i,o,s){return null==i&&(i=1),null==o&&(o=1),null==s&&(s=1),i*=this.tileW,o*=this.tileH,this.ctx.drawImage(this.sprites,t*i,e*o,i,o,r,n,i*s,o*s)}};var keys;keys={up:!1,down:!1,left:!1,right:!1,space:!1,reset:function(){return this.up=this.down=this.left=this.right=this.space=!1},trigger:function(t,e,r){switch(t){case 37:this.left=e;break;case 39:this.right=e;break;case 38:this.up=e;break;case 40:this.down=e;break;case 32:e&&console.log("FIRE!"),this.space=e}return r.preventDefault()}},document.addEventListener("keydown",function(t){return keys.trigger(t.keyCode,!0,t)},!1),document.addEventListener("keyup",function(t){return keys.trigger(t.keyCode,!1,t)},!1);var Entity;Entity=function(){function t(t,e,r){this.level=t,this.x=e,this.y=r}return t.prototype.speed=4,t.prototype.dir="LEFT",t.prototype.update=function(){},t.prototype.render=function(t){return t.ctx.fillText("?",this.x,this.y)},t}();var Ninja,_ref,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Ninja=function(t){function e(){return _ref=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.render=function(t){return t.drawSprite(0,1,this.x,this.y)},e}(Entity);var Player,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Player=function(t){function e(t,r,n){e.__super__.constructor.call(this,t,r,n),this.dir="RIGHT"}return __extends(e,t),e.prototype.update=function(){return keys.left&&(this.x-=this.speed),keys.right&&(this.x+=this.speed),keys.down&&(this.y+=this.speed),keys.up?this.y-=this.speed:void 0},e.prototype.render=function(t){return t.drawSprite(0,0,this.x,this.y)},e}(Entity);var Block;Block=function(){function t(){}return t.prototype.solid=!1,t.prototype.update=function(){},t.prototype.render=function(){},t}();var Treasure,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Treasure=function(t){function e(){this.yOff=Math.random()*Math.PI}return __extends(e,t),e.prototype.update=function(){return this.yOff+=Math.PI/24},e.prototype.render=function(t,e,r){var n;return n=Math.floor(4*Math.sin(this.yOff)),t.drawSprite(5,1,e,r+n)},e}(Block);var Dirt,_ref,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Dirt=function(t){function e(){return _ref=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.solid=!0,e.prototype.render=function(t,e,r){return t.drawSprite(4,1,e,r)},e}(Block);var Rock,_ref,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Rock=function(t){function e(){return _ref=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.solid=!0,e.prototype.render=function(t,e,r){return t.drawSprite(4,0,e,r)},e}(Block);var levels;levels=[{name:"DIG and BUILD",data:".P................X.....\n@-@@.........@@@@@@@-@..\n.#..@@@.............#...\n.#.....@@.@@.....X..#...\n@OO#.........#@@...O#..^\n...#.........#......#.^O\n...#..@@-@@@@#..-@@@@@OO\n...#....#....#..#.......\n...#....#....#..#.......\n...#....#....#..#.......\n@-@@OOOOO.#.@@@@@#@@-@@@\n.#.X......#......#..#...\n.#...*....#......#..#...\n####..@@#@@..-@@@@@@@..*\n####....#....#.........#\n####....#....#.........#\nOOOOOOOOOOOOOOOOOOOOOOOO"}];var Level;Level=function(){function t(t,e){this.game=e,this.load(t)}return t.prototype.w=0,t.prototype.h=0,t.prototype.treasures=0,t.prototype.ninjas=[],t.prototype.load=function(t){var e,r,n,i,o;return this.ninjas=[],this.treasures=0,e=function(){var e,r,i,o;for(i=t.data.split("\n"),o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n.split(""));return o}(),this.map=function(){var t,s,u;for(u=[],o=t=0,s=e.length;s>t;o=++t)n=e[o],u.push(function(){var t,e,s;for(s=[],i=t=0,e=n.length;e>t;i=++t)switch(r=n[i]){case"P":this.addPlayer(i,o),s.push(new Block);break;case"X":this.addNinja(i,o),s.push(new Block);break;case"*":this.treasures++,s.push(new Treasure);break;case"@":s.push(new Dirt);break;case"O":s.push(new Rock);break;default:s.push(new Block)}return s}.call(this));return u}.call(this),this.h=this.map.length,this.w=this.map[0].length},t.prototype.addPlayer=function(t,e){return this.game.setPlayer(t*gfx.tileW,e*gfx.tileH,this)},t.prototype.addNinja=function(t,e){var r,n,i;return n=t*gfx.tileW,i=e*gfx.tileH,r=new Ninja(this,n,i),this.ninjas.push(r)},t.prototype.update=function(){var t,e,r,n,i,o,s,u,p,a,h,c;for(a=this.map,n=0,s=a.length;s>n;n++)for(r=a[n],i=0,u=r.length;u>i;i++)t=r[i],t.update();for(h=this.ninjas,c=[],o=0,p=h.length;p>o;o++)e=h[o],c.push(e.update());return c},t.prototype.render=function(t){var e,r,n,i,o,s,u,p,a,h,c,l,f,d;for(l=this.map,o=s=0,a=l.length;a>s;o=++s)for(n=l[o],i=u=0,h=n.length;h>u;i=++u)e=n[i],e.render(t,i*t.tileW,o*t.tileH);for(f=this.ninjas,d=[],p=0,c=f.length;c>p;p++)r=f[p],d.push(r.render(t));return d},t}(),this.game={running:!1,init:function(){return gfx.init()?gfx.load(function(){return game.reset(),console.log("Ready.")}):(alert("Sorry your browser doesn't support this game :("),void 0)},stop:function(){return this.running=!1},start:function(){return this.running=!0},reset:function(){return keys.reset(),this.player=new Player,this.level=new Level(levels[0],this),this.running?void 0:(this.start(),this.tick())},setPlayer:function(t,e,r){return this.player.level=r,this.player.x=t,this.player.y=e},tick:function(){return this.running?(gfx.clear(),this.update(),this.render(),requestAnimationFrame(function(){return game.tick()})):void 0},update:function(){return this.level.update(),this.player.update()},render:function(){return this.level.render(gfx),this.player.render(gfx)}};